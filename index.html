<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Abnahme</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <style>
    body {
  font-family: "Roboto", Arial, sans-serif;
  margin: 20px;
  background: url("images/heilbronn-fliesenleger-fliesenreinigung.jpeg") no-repeat center center fixed;
  background-size: cover; /* ØªØ®Ù„ÙŠ Ø§Ù„ØµÙˆØ±Ø© ØªØºØ·ÙŠ Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø© */
  color: #333;
}






#reportPreview {
  display:none;
  background: url("images/-heilbronn-startseite-uebersicht-1.webp") no-repeat center center;
  background-size: cover;
  padding:25px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,0.15);
  max-width:850px;
  margin:auto;
  min-height: 1123px;
}








     h1 { text-align:center; color:chartreuse; }
    h2,h3 { text-align:center; color:#004080; }
    #report, #reportPreview {
      background:#fff; padding:25px; border-radius:12px;
      box-shadow:0 4px 12px rgba(0,0,0,0.15); max-width:850px; margin:auto;
    }
    label { display:block; margin-top:15px; font-weight:bold; color:#004080; }
    input,textarea { width:100%; padding:10px; margin-top:5px; border-radius:6px; border:1px solid #ccc; box-sizing:border-box; font-size:14px; }
    textarea{ resize:vertical; }
    canvas{ border:2px dashed #004080; width:100%; height:150px; margin-top:10px; border-radius:6px; background:#fafafa; }
    button{ margin-top:15px; padding:10px 18px; border:none; border-radius:6px; cursor:pointer; font-size:14px; transition:0.2s; }
    #saveBtn{ background:#007BFF; color:#fff; }
    #saveBtn:hover{ background:#0056b3; }
    #clearSig{ background:#dc3545; color:#fff; }
    #clearSig:hover{ background:#a71d2a; }
    #addMaterial{ background:#28a745; color:#fff; margin-top:10px; }
    #addMaterial:hover{ background:#1e7e34; }
    .actions{ display:flex; gap:10px; margin-top:20px; justify-content:center; }
    .materials-list input{ margin-bottom:8px; }
    .no-print{ display:block; }
   /* #reportPreview{ display:none; }*/
    .image-box{ margin:10px 0; }
    .image-box img{ max-width:100%; height:auto; display:block; margin:auto; }
    .pdf-images img{
      display:block; max-width:100%; max-height:100%;
      object-fit:contain; margin:10px auto;
      page-break-before:always;
    }
  </style>
</head>
<body>
  <div class="image-box">
        <a href="https://www.adragna-wohndesign.de/#raum-umgebung.html" target="_blank">
          <img src="images/heilbronn-fliesenleger-fliesenreinigung-logo.jpeg" alt="Mein Logo"/>
        </a>

        <a href="https://www.adragna-wohndesign.de/#raum-umgebung.html" target="_blank">
          <img src="images/heilbronn-fliesenleger-fliesenreinigung-logo-text.jpeg" alt="Mein Logo"/>
        </a>

  </div>


 



       
<h1>Abnahme</h1>

<div id="report">
  <label>Kundenname</label>
  <input type="text" id="kunde" placeholder="Name des Kunden" />
   <label>Email</label>
  <input type="text" id="Email" placeholder="email adresse" />
  <label>Telefonnummer</label>
  <input type="text" id="Telefonnummer" placeholder="telefonnummer eingeben" />

  <h3>Adresse</h3>
  <label>StraÃŸe und Hausnummer</label>
  <input type="text" id="strasse" placeholder="z.B. MusterstraÃŸe 12" />
  <label>Postleitzahl</label>
  <input type="text" id="plz" placeholder="z.B. 12345" />
  <label>Ort</label>
  <input type="text" id="ort" placeholder="z.B. Berlin" />

  <label>Verwendete Materialien</label>
  <div id="materials" class="materials-list">
    <input type="text" placeholder="Material eingeben" />
  </div>
  <button type="button" id="addMaterial" class="no-print">+ Material hinzufÃ¼gen</button>

  <label>DurchgefÃ¼hrte Arbeiten</label>
  <textarea id="arbeit" rows="3" placeholder="Arbeiten beschreiben"></textarea>

  <label>Datum</label>
  <input type="date" id="datum" />

  <label>Unterschrift des Kunden</label>
  <canvas id="signature-pad"></canvas>

  <label>Bilder hochladen</label>
  <input type="file" id="imageUpload" accept="image/*" multiple />
  <div id="imagePreview"></div>
</div>

<div class="actions no-print">
  <button type="button" id="clearSig">ðŸ§¹ Unterschrift lÃ¶schen</button>
  <button type="button" id="saveBtn">ðŸ’¾ Als PDF speichern</button>
</div>

<div id="reportPreview"></div>

<script>
const canvas = document.getElementById("signature-pad");
const signaturePad = new SignaturePad(canvas);
const preview = document.getElementById("reportPreview");

document.getElementById("clearSig").addEventListener("click", ()=>signaturePad.clear());

document.getElementById("addMaterial").addEventListener("click", ()=>{
  const div=document.getElementById("materials");
  const input=document.createElement("input");
  input.type="text"; input.placeholder="Material eingeben";
  div.appendChild(input);
});

// Datum auf heute setzen
document.getElementById("datum").value = new Date().toISOString().split("T")[0];

// Bilder hochladen und Vorschau
document.getElementById("imageUpload").addEventListener("change", function(event){
  const files = event.target.files;
  const previewDiv = document.getElementById("imagePreview");
  previewDiv.innerHTML="";
  Array.from(files).forEach(file=>{
    const reader = new FileReader();
    reader.onload = function(e){
      const div=document.createElement("div");
      div.className="image-box";
      const img=document.createElement("img");
      img.src=e.target.result;
      div.appendChild(img);
      previewDiv.appendChild(div);
    }
    reader.readAsDataURL(file);
  });
  event.target.value='';
});

// Bilder in Base64 fÃ¼r PDF
async function getUploadedImagesBase64(){
  const imgs=document.querySelectorAll("#imagePreview .image-box img");
  const arr=[];
  imgs.forEach(img=>{
    arr.push(`<img src="${img.src}" alt="Bild" />`);
  });
  return arr.join("");
}

// Warten bis Bilder geladen
function waitForImagesToLoad(container){
  const images=container.querySelectorAll("img");
  const promises=[];
  images.forEach(img=>{
    if(!img.complete){
      promises.push(new Promise(resolve=>{ img.onload=img.onerror=resolve; }));
    }
  });
  return Promise.all(promises);
}

// Datum formatieren
function formatDateToGerman(dateStr){
  if(!dateStr) return "-";
  const date=new Date(dateStr);
  return date.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"});
}

// PDF speichern
document.getElementById("saveBtn").addEventListener("click", async ()=>{
  if(signaturePad.isEmpty()){ alert("Bitte unterschreiben, bevor Sie speichern!"); return; }

  const kunde=document.getElementById("kunde").value;
  const Email=document.getElementById("Email").value;
  const Telefonnummer=document.getElementById("Telefonnummer").value;
  const strasse=document.getElementById("strasse").value;
  const plz=document.getElementById("plz").value;
  const ort=document.getElementById("ort").value;
  const arbeit=document.getElementById("arbeit").value;
  const datum=formatDateToGerman(document.getElementById("datum").value);
  const signatureImage=signaturePad.toDataURL();
  const materialsInputs=document.querySelectorAll("#materials input");
  let materialsList="";
  materialsInputs.forEach(inp=>{ if(inp.value.trim()!=="") materialsList+=`<li>${inp.value}</li>`; });

  const imagesHTML=await getUploadedImagesBase64();

  preview.innerHTML=`
   
    <h2>Abnahme</h2>
   
  
   <div style="text-align:center; margin-bottom:20px;">
  <img src="images/heilbronn-fliesenleger-fliesenreinigung-logo.jpeg" 
       alt="Logo" style="max-width:150px;" />
  <img src="images/heilbronn-fliesenleger-fliesenreinigung-logo-text.jpeg" 
       alt="Logo Text" style="max-width:250px;" />
</div>
  
    <p><strong>Kunde:</strong> ${kunde||"-"}</p>
    <p><strong>Email:</strong> ${Email||"-"}</p>
    <p><strong>Telefonnummer:</strong> ${Telefonnummer||"-"}</p>
    <p><strong>Adresse:</strong> ${strasse||"-"}, ${plz||""} ${ort||""}</p>
    <p><strong>Materialien:</strong></p>
    <ul>${materialsList||"<li>-</li>"}</ul>
    <p><strong>Arbeiten:</strong><br>${arbeit||"-"}</p>
    <p><strong>Datum:</strong> ${datum}</p>
    <p><strong>Unterschrift:</strong></p>
    <img src="${signatureImage}" alt="Unterschrift" style="max-width:300px; display:block; margin:20px auto;" />
    <h3>Bilder:</h3>
    <div class="pdf-images">${imagesHTML||"<p>-</p>"}</div>
  `;

  document.getElementById("report").style.display="none";
  preview.style.display="block";
  await waitForImagesToLoad(preview);

  const opt={
    margin:0.5,
    filename:'Abnahme.pdf',
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2,useCORS:true,scrollY:0},
    jsPDF:{unit:'pt',format:'a4',orientation:'portrait'},
    pagebreak:{mode:['avoid-all','css','legacy']}
  };
  await html2pdf().set(opt).from(preview).save();

  document.getElementById("report").style.display="block";
  preview.style.display="none";
});
</script>

</body>
</html>
